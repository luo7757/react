# Context
上下文：Context，表示做某一些事情的环境

React中的上下文特点：
1. 当某个组件创建了上下文后，上下文中的数据，会被所有后代组件共享
2. 如果某个组件依赖了上下文，会导致该组件不在纯粹（外部数据仅来源于属性props）
3. 一般情况下，用于第三方组件（通用组件）

## 旧的API
**创建上下文**

只有类组件才可以创建上下文

1. 给类组件书写静态属性 childContextTypes，使用该属性对上下文中的数据类型进行定义
2. 添加实例方法，getChildContext，该方法返回的对象，就是上下文对象，必须满足属性约束，该方法会在每次render之后运行

**使用上下文数据**
要求：如果要使用上下文中的数据，组件必需要使用一个静态属性 contextTypes来获取上下文中的数据
1. 在构造函数中有了第二个参数 context，就是获取到的上下文对象
2. **从组件的context中获取**
3. 在函数组件中，通过第二个参数，来获取上下文属性

**上下文的数据变化**
上下文中的数据不可以直接变化，最终都是通过状态改变 
在上下文中加入一个处理函数，可以用于后代组件更改上下文数据

**多个上下文的情况**
组件A有个上下文
组件A的子组件B也有个上下文
在组件B的子组件C中 获取上下文 类似于 js中的作用域，同名的会找最近了，但类型必须一致，不然会报错

在定义 一个函数用于修改上下文的数据时，根据函数中的运行环境中的this指向来确定 修改的数据目标

**新版APi**
旧版API存在严重效率问题，在语法方面也有问题，并且容易导致滥用

**创建上下文**
上下文在新版中 独立于组件，其思想就像一个数据管理库(vuex)
通过 React.createContext() 创建一个上下文 可以是一个原始类型 也可以是一个对象
返回的是一个包含两个属性的对象

1. Provider属性(生产者)：一个组件，该组件会创建一个上下文，该组件有一个value属性,可以通过该属性为其数据赋值 
   1. 同一个Provider不要在多个组件中重复使用 ，如果需要多个组件使用，应该提升Provider的层级
   2. 可以创建不同的Provider
2. Comsumer属性：

**使用上下文**

要求：必须拥有静态属性 contextType ,应赋值为创建的上下文对象

1. 在类组件中，直接使用 this.context 获取上下文数据
2. 在函数组件中，需要使用 Consumer 来获取上下文数据
   1. Consumer 是一个组件
   2. 它的子节点是一个函数（它的props.child 是一个函数）
**注意细节**
如果 上下文提供者(Context.Provider)的value属性变化了（地址不一样），会导致该上下文提供的所有后代元素全部重新渲染，
无论该子元素是否有优化（shouldComponentUpdate 函数什么结果都会重新渲染）强制重新渲染
为了保证数据的准确性，如果上下文变了 子元素拥有的上下文不变，如果进行一些操作，那么是不是会出现数据错误的情况

如果在某些有优化的地方不要让这个组件被重新渲染
可以将这个组件需要属性放在一个state中的一个对象中
state对象变化了，但里面的对象地址不会变化，在比较时 地址相同就不会强制重新渲染 走正常的生命周期流程，就能被优化了