# State Hook 

State Hook 是一个在函数组件中使用的函数（useState），用于在函数组件中使用状态

useState 代码在app.jsx中
- 函数有一个参数，这个参数的值表示状态的默认值
- 函数的返回值是一个数组，该数组一定包含两项
  - 第一项：当前状态值
  - 第二项：改变状态的函数

一个函数组件中可以有多个状态，这种做法非常有利于横切关注点

**注意细节**
1. useState 最好学到函数的其实位置，以便于阅读
2. useState 严禁出现在代码块中（判断、循环等）
3. useState 返回的函数（数组的第二项），引用不变（节约内存空间）
4. 如果使用函数改变数据，若数据和之前的数据完全相等（使用Object.is比较），不 会重新渲染,以达到优化效率的目的
5. 使用函数改变数据，传入的值不会和原来的数据进行合并，而是直接覆盖（替换）。（逻辑设计问题：单一用途的数据，不应该和其他用途的数据共存，useState 是一个多用途状态，采用混合）
6. 千万不要直接改变对象（保证数据来源纯净）
7. 如果要实现强制刷新组件
   1. 类组件：使用 forceUpdate 函数(不会运行shouldComponentUpdate)
    ```
    <button onClick={() => {this.forceUpdate()}}></button>
    ```
    2. 函数组件：使用一个空对象来进行强制刷新（对象地址不一致，导致重新渲染）
8. **如果某些状态之间没有必然的联系，应该分化为不同的状态，而不要合并成一个对象**
9. 和类组件的状态一样，函数组件中改变可能时异步的（在DOM事件中），多个状态变化会合并以提高效率，此时不能信任之前的状态，而应该使用回调函数的方式改变状态,如果状态变化要使用到之前的状态，一定使用函数来改变状态（多次改变时，一次调用时可以直接传入改变后的数据）
  ```
  <button
      onClick={() => {
        // setN(n + 1) //不会立即改变，事件运行完成之后一起改变
        // setN(n + 1) //此时，n的值仍然是0

        setN((prevN) => prevN + 1); //传入的函数，在事件完成之后统一运行
        setN((prevN) => prevN + 1);
      }}
    >
      +
  </button>
  ```

**在类组件中状态 必须是一个对象，但在函数组件中，使用useState 可以是原始类型**

## State Hook 原理
1. 当运行一个函数组件时（调用该组件），在渲染组件时会生成一个组件节点，
  这个节点保存了组件的标识，首次运行 useState 中接受到一个状态保存的请求，
  检查这个节点的状态是否初始化，没有就初始化。
  后续再次调用 render 时，在生成 newDOM 树时，先检查当前节点的状态，返回最新状态，根据 diff 对比结果，更新 虚拟DOM树，最后更新真实DOM树
  - 详细
  - 首次调用
     1. 调用useState
     2. 检查该节点的状态表格
     3. 使用默认值创建一个状态
     4. 将该状态加入到表格中
  - N 次调用
     1. 第 N 次调用 useState
     2. 检查该节点的状态数组是否存在下标 N
     3. 不存在
        1. 使用默认值创建一个状态
        2. 将该状态加入到状态数组中，下标为 N
     4. 存在，忽略默认值，根据下标，返回该节点状态数组的下标 N 的状态

