# ref
有些时候我们希望直接操作某一个dom元素
ref 和 vue 的 ref 差不多。

ref 在组件上时，代表组件的实例，在内置组件上时对应的是一个dom元素
```
<Comp ref="Comp">
这个ref获取的是类组件的实例
如果是一个函数组件，就不适用ref
<div ref="div"></div>
这个ref获取的是一个真实dom元素
```

1、ref 作用于内置的html组件，得到的将是真实的dom对象
2、ref 作用于类组件，得到的将是类的实例
3、ref 不能作用于函数组件

ref 不再推荐使用字符串赋值，字符串赋值的方式将来可能会被移除

目前，ref推荐使用对象或者是函数

**对象**
通过 React.createRef 函数创建
```
constructor(props){
 super(props)
 this.txt = React.createRef()
 <!-- or -->
 this.txt = {
  current: null
 }
}
改用这种方式来指定 ref
render(){
 return (
  <div ref={this.txt}>卧槽</div>

  <div ref={(el) => this.txt = el}></div>
  // el 就是当前的元素/组件
  // 函数写法 this.txt 直接变为当前的对象
 )
}

使用时
this.txt.current 就是当前的 ref 绑定对象

this.txt.current.innerText
```

**函数**

```
render(){
 return (
  <div ref={(el) => this.txt = el}>我熬</div>
  // el 就是当前的元素/组件
  // 函数写法 this.txt 直接变为当前的对象
  // 使用 this.txt.innerText
 )
}
```
这个函数会在什么时候运行呢？
首先在第一次渲染组件的时候会运行一次
在数据变动时会变动两次

1. componentDidMount 的时候之前会调用该函数一次
   1. 在 componentDidMount事件中可以使用ref
2. 如果ref的值 发生了变动（旧的函数被新的函数替代），会分别调用旧的函数以及新的函数，时间点出现在componentDidUpdate之前（调用两次）
   1. 旧的函数在销毁时，真实的dom没有销毁，将 ref 夫赋值 为null
   2. 新的函数创建了，其 ref 重新赋值为 绑定dom/组件 
   3. 为什么会运行两次，react 认为 你可能会需要在 ref 绑定时进行一些操作 ，防止操作失误，而运行两次，第一次null
3. 如果将ref 绑定函数 提取出来 react认为只是绑定一下引用，这时候只会运行一次
4. 如果组件的真实dom被销毁了，就会重新运行一次

**谨慎使用 ref**
react 旨在数据变化，而不是直接操控dom，这是反模式了，但确实在一些时候是需要操作真实dom的，能够使用属性和状态进行控制就不要使用ref
1. 调用真实dom对象中的方法，如canvas、video，audio等需要直接操作dom的元素
2. 某个时候需要调用类组件的方式，如：表单主动验证
